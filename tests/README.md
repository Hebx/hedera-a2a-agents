# Hedron Test Suite

This directory contains comprehensive tests for the Hedron System, organized by test type and functionality.

## ğŸ“ Test Organization

### `/unit` - Individual Agent Tests

Tests for individual agent functionality:

- `test-analyzer.ts` - AnalyzerAgent functionality
- `test-verifier.ts` - VerifierAgent functionality
- `test-settlement.ts` - SettlementAgent functionality

### `/integration` - x402 Payment Integration Tests

Tests for x402 payment protocol integration based on [a2a-x402-typescript](https://github.com/dabit3/a2a-x402-typescript):

- `test-improved-x402.ts` - Improved x402 implementation
- `test-merchant-agent.ts` - Merchant agent with x402PaymentRequiredException
- `test-payment-server.ts` - Server-side verification and settlement
- `test-enhanced-x402utils.ts` - Enhanced payment state management
- `test-complete-x402-system.ts` - Complete integrated x402 system

### `/e2e` - End-to-End Coordination Tests

Tests for complete agent coordination workflows:

- `test-complete-coordination.ts` - Full 3-agent coordination via HCS-10
- `test-working-coordination.ts` - Working coordination with HCS workaround
- `test-payment-flow.ts` - Complete payment flow simulation

### `/debug` - Debugging and Utility Tests

Debugging tools and utility tests:

- `test-direct-payment.ts` - Direct payment testing
- `test-direct-usdc-transfer.ts` - Direct USDC transfer testing
- `test-funded-payment.ts` - Payment testing with funded wallet
- `test-payment-debug.ts` - Payment debugging utilities
- `test-settlement-payment.ts` - Settlement payment testing
- `test-x402-complete.ts` - Complete x402 flow testing
- `test-x402-server.ts` - x402 server implementation testing

## ğŸš€ Running Tests

### Individual Test Categories

```bash
# Unit tests (individual agents)
npm run test:unit

# Integration tests (x402 payments)
npm run test:integration

# End-to-end tests (coordination)
npm run test:e2e

# Debug tests (utilities)
npm run test:debug
```

### Specific Tests

```bash
# Individual agent tests
npm run test:analyzer
npm run test:verifier
npm run test:settlement

# x402 payment tests
npm run test:merchant
npm run test:server
npm run test:utils
npm run test:complete

# Coordination tests
npm run test:coordination
npm run test:working
```

### All Tests

```bash
npm run test:all
```

## ğŸ“‹ Test Prerequisites

1. **Environment Setup**: Ensure `.env` file is configured with:
   - `HEDERA_ACCOUNT_ID` and `HEDERA_PRIVATE_KEY`
   - `BASE_RPC_URL` and `SETTLEMENT_WALLET_PRIVATE_KEY`
   - `USDC_CONTRACT` and `MERCHANT_WALLET_ADDRESS`
   - Agent-specific credentials (generated by `npm run setup:agents`)

2. **Wallet Funding**: Ensure settlement wallet has:
   - ETH for gas fees (~0.01 ETH)
   - USDC for payments (10+ USDC)

3. **Network Access**: Tests require:
   - Hedera Testnet access
   - Base Sepolia RPC access

## ğŸ”§ Test Features

### Unit Tests

- âœ… Individual agent initialization
- âœ… Agent-specific functionality
- âœ… Error handling and edge cases

### Integration Tests

- âœ… x402PaymentRequiredException flow
- âœ… Server-side verification and settlement
- âœ… Enhanced payment state management
- âœ… Complete x402 payment protocol

### End-to-End Tests

- âœ… 3-agent coordination via HCS-10
- âœ… Cross-chain payment execution
- âœ… Real blockchain transactions
- âœ… Autonomous agent workflows

### Debug Tests

- âœ… Wallet status checking
- âœ… Direct payment testing
- âœ… Payment debugging utilities
- âœ… HCS communication testing

## ğŸ“Š Test Results

All tests demonstrate:

- âœ… **Autonomous Agent Coordination** - Agents work together without human intervention
- âœ… **Real Blockchain Transactions** - Actual USDC payments on Base Sepolia
- âœ… **Cross-Chain Integration** - Hedera agents coordinating Ethereum payments
- âœ… **x402 Payment Protocol** - Complete implementation based on official standards
- âœ… **HCS Communication** - Hedera Consensus Service message passing
- âœ… **Error Handling** - Comprehensive error handling and recovery

## ğŸ”— Related Documentation

- [README.md](../README.md) - Project overview and setup
- [PRD.md](../PRD.md) - Product requirements document
- [Architecture.md](../Architecture.md) - System architecture
- [SETUP.md](../SETUP.md) - Setup instructions

## ğŸ¯ Test Coverage

The test suite provides comprehensive coverage of:

- **Agent Functionality** - All three agent types tested
- **Payment Protocols** - Complete x402 implementation
- **Communication** - HCS-10 message passing
- **Blockchain Integration** - Real transaction execution
- **Error Scenarios** - Failure handling and recovery
- **State Management** - Payment tracking and statistics
